<!DOCTYPE html>
<html>
<head>
  <title>Mirror</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <video autoplay="true" id="camera"></video>
  <p id="message"></p>
  <button id="button">Mirror Mirror</button>

  <script>
    var video = document.querySelector("#camera");

    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ video: true, facingMode: "user" })
        .then(function (stream) {
        video.srcObject = stream;
        })
        .catch(function (err0r) {
        console.log("Something went wrong!");
        });
    }

    const button = document.getElementById('button');

    function playRandomPhrase() {
    const phrases = [
        "You are looking fabulous today!",
        "You are the fairest of them all.",
        "Who's awesome? You're awesome!"
    ];

    // Generate a random index
    //var phrase = phrases[Math.floor(Math.random() * phrases.length)];
    const index = Math.floor(Math.random() * phrases.length);

    // Get the phrase at the selected index
    const phrase = phrases[index];

    // Create an AudioContext
    const audioContext = new AudioContext();

    // Use speech synthesis to play the phrase
    const utterance = new SpeechSynthesisUtterance(phrase);
    speechSynthesis.speak(utterance);

    // Get the <p> element with the id "message"
    var messageElement = document.getElementById("message");

    // Set the innerHTML of the <p> element to the selected statement
    messageElement.innerHTML = phrase;
    }

    button.addEventListener('click', playRandomPhrase);

    //Speech recognition
    const SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;
    const SpeechGrammarList = window.SpeechGrammarList || webkitSpeechGrammarList;
    const SpeechRecognitionEvent = window.SpeechRecognitionEvent || webkitSpeechRecognitionEvent;

    // Create a new SpeechRecognition instance
    const recognition = new SpeechRecognition();

    // Set the language to English
    recognition.lang = 'en-US';

    // Set the continuous and interimResults properties to true
    // so that the recognition will continue until the user stops speaking
    recognition.continuous = true;
    recognition.interimResults = true;

    // Set the maxAlternatives property to 1 to return only the most
    // likely result
    recognition.maxAlternatives = 1;

    // Start listening for speech
    recognition.start();

    //recognition.onresult = (event) => {
    // Get the transcript of the recognized speech
    //var transcript = event.results[0][0].transcript;

    // Check if the result matches the phrase "mirror mirror"
    //if (transcript.toLowerCase().includes("mirror mirror")) {
        // If it does, call the playRandomPhrase function
        //playRandomPhrase();
    //}

    // Define a flag variable to track whether the playRandomPhrase function has been called
    var played = false;

    // Define a variable to hold the current transcript
    var transcript = "";

    // Define a regular expression to match the pattern "mirror mirror" followed by an optional space and any other words
    const regex = /^mirror mirror\s?\w*/;

    recognition.onresult = (event) => {
    // Check if the result is final
    if (event.results[0].isFinal) {

        // Get the transcript of the recognized speech
        //var transcript = event.results[0][0].transcript;

        // Update the transcript with the recognized speech
        transcript += event.results[0][0].transcript;

        // Check if the result matches the phrase "mirror mirror" and the playRandomPhrase function has not yet been called
        if (regex.test(transcript.toLowerCase()) && !played) {
        //if (transcript.toLowerCase().includes("mirror mirror") && !played) {
            // If it does, call the playRandomPhrase function
            playRandomPhrase();

            // Set the flag to true to indicate that the function has been called
            played = true;

            // Reset the transcript to an empty string
            transcript = "";

            // Set a timeout to reset the flag after 5 seconds
            setTimeout(() => {
            played = false;
            }, 4000);
        }
    }
    };


  </script>
</body>
</html>